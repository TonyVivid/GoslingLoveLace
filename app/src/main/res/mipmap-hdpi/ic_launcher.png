package com.example.a1.version1;

import android.content.Intent;
import android.os.AsyncTask;
import android.os.Handler;
import android.os.Message;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.OutputStream;
import java.net.InetSocketAddress;
import java.net.Socket;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import trans_data.chatInfo;

public class chat extends AppCompatActivity {
    Handler handler;
 chatInfo myinfo=null;
 TextView txt_chatInfo=null;
 EditText edt=null;
 String txt_info="";
String sender="";
    @Override
    protected void onPause() {
        if(getbackMessage!=null && getbackMessage.getStatus() == AsyncTask.Status.RUNNING){
            getbackMessage.cancel(true);
        }
        super.onPause();
    }
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_chat);
        txt_chatInfo=findViewById(R.id.txt_chatInfo);
        edt=findViewById(R.id.txt_input);
        getbackMessage.execute();
        init();
        handler=new Handler(){

            @Override
            public void handleMessage(Message msg) {
                super.handleMessage(msg);
                if(msg.what==666)
                {
                    new chatThread().start();
                }
                if(msg.what==667){

                    TextView txt_header=(TextView) findViewById(R.id.txt_header);
                    String sender=txt_header.getText().toString();
                    txt_info=txt_info+"\n"+myinfo.getInfo();
                    txt_chatInfo.setText(txt_info);
                }
                if(msg.what==668){
                    edt.setText("");
                    txt_chatInfo.setText(txt_info);
                }
            }
        };
    }
public void updateUI(){

}
    public void init(){
        String owner=getIntent().getStringExtra("owner");
        chatInfo info =(chatInfo) getIntent().getSerializableExtra("chatinfo");
        if(info!=null){
            TextView txt_header=(TextView) findViewById(R.id.txt_header);
            txt_header.setText(info.getSender());
            txt_chatInfo.setText(info.getInfo());
        }
        else {
            TextView txt_header = (TextView) findViewById(R.id.txt_header);
            txt_header.setText(owner);
        }


    }

AsyncTask<Void,String,Void> getbackMessage=new AsyncTask<Void, String, Void>() {
    @Override
    protected Void doInBackground(Void... voids) {

       